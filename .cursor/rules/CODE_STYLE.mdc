---
name: Code Style Guidelines
description: Code formatting, naming conventions, and file organization
globs:
  - '**/*.ts'
  - '**/*.tsx'
alwaysApply: true
---

# Code Style Guidelines

## Formatting Standards

### Prettier Configuration

This project uses Prettier for code formatting. **Always use the project's Prettier configuration**.

**Configuration file:** `prettier.config.js`

```bash
# Format code
yarn format

# Check formatting
yarn format:check
```

### ESLint Configuration

This project uses ESLint for code quality. **Always use the project's ESLint configuration**.

**Configuration file:** `eslint.config.js`

```bash
# Lint code
yarn lint
```

### Automated Formatting

Code is automatically formatted on commit via Husky and lint-staged:

```json
{
  "lint-staged": {
    "*.{ts,tsx}": ["eslint --ext .tsx,.ts --cache --fix", "prettier --write", "git add"]
  }
}
```

## Naming Conventions

### Files and Directories

#### Source Files

- **kebab-case** for all files
- `.ts` for TypeScript, `.tsx` for JSX components
- One main export per file

```
✅ Good:
frontend/src/components/theme-switch/index.tsx
frontend/src/services/session.ts
frontend/src/pages/home.tsx

❌ Avoid:
frontend/src/components/ThemeSwitch.tsx
frontend/src/services/Session.ts
frontend/src/pages/Home.tsx
```

#### Test Files

- **Same name as source** with `.spec.ts` suffix
- Co-located with source file when possible

```
✅ Good:
frontend/src/environment-options.ts
frontend/src/environment-options.spec.ts

❌ Avoid:
test/environment-options.spec.ts (not co-located)
frontend/src/environment-options.test.ts (use .spec.ts)
```

### Components and Classes

- **PascalCase** for components, classes, and types
- Descriptive and clear purpose

```typescript
// ✅ Good
export const ThemeSwitch = Shade(...)
export const MonacoEditor = Shade(...)
export type EditorOptions = {}

// ❌ Avoid
export const themeSwitch = Shade(...) // Wrong case
export const editor = Shade(...) // Too generic
```

### Functions and Variables

- **camelCase** for functions and variables
- **UPPER_SNAKE_CASE** for constants

```typescript
// ✅ Good
export function getEnvironmentOptions() {}
export const isValidJson = true
export const DEFAULT_THEME = 'dark'

// ❌ Avoid
export function GetEnvironmentOptions() {}
export const IsValidJson = true
```

## Project Structure

### Directory Organization

```
json-tools/
├── frontend/                # Frontend application
│   └── src/
│       ├── index.tsx        # App entry point
│       ├── components/      # Reusable components
│       │   ├── header.tsx
│       │   ├── body.tsx
│       │   ├── layout.tsx
│       │   ├── theme-switch/
│       │   │   └── index.tsx
│       │   ├── github-logo/
│       │   │   ├── index.tsx
│       │   │   ├── gh-dark.png
│       │   │   └── gh-light.png
│       │   └── monaco/
│       │       ├── monaco-editor.tsx
│       │       └── monaco-diff-editor.tsx
│       ├── pages/           # Page components
│       │   ├── home.tsx
│       │   ├── compare.tsx
│       │   └── validate.tsx
│       ├── services/        # Frontend services
│       └── themes/          # Theme definitions
└── e2e/                     # End-to-end tests
    └── page.spec.ts
```

### Component File Structure

Components should be organized in directories when they have assets:

```
components/
├── theme-switch/
│   └── index.tsx           # Component with no assets
├── github-logo/
│   ├── index.tsx           # Component
│   ├── gh-dark.png         # Dark theme asset
│   └── gh-light.png        # Light theme asset
└── header.tsx              # Simple component (no directory needed)
```

## Import Ordering

### Import Order

1. **Node built-ins**
2. **External dependencies** (npm packages)
3. **FuryStack packages** (`@furystack/*`)
4. **Relative imports**
5. **Type imports** (if separated)

```typescript
// ✅ Good - organized imports
import { EventEmitter } from 'events'

import { Shade } from '@furystack/shades'
import { Injector } from '@furystack/inject'

import { MonacoEditor } from '../components/monaco/monaco-editor.js'
import type { EditorOptions } from './types.js'

// ❌ Avoid - random ordering
import { MonacoEditor } from '../components/monaco/monaco-editor.js'
import { EventEmitter } from 'events'
import { Injector } from '@furystack/inject'
```

### Import Grouping

Separate import groups with blank lines:

```typescript
// ✅ Good - separated groups
import { Injector } from '@furystack/inject'
import { Shade } from '@furystack/shades'

import { MonacoEditor } from './components/monaco/monaco-editor.js'
```

## Code Organization

### Component File Structure

```typescript
// 1. Imports
import { Shade } from '@furystack/shades';

// 2. Types
type MyComponentProps = {
  title: string;
};

// 3. Component
export const MyComponent = Shade<MyComponentProps>({
  shadowDomName: 'my-component',
  render: ({ props }) => {
    return <div>{props.title}</div>;
  },
});
```

### Service File Structure

```typescript
// 1. Imports
import { Injectable, Injected } from '@furystack/inject'
import { ObservableValue } from '@furystack/utils'

// 2. Types
type ServiceState = {
  data: string
}

// 3. Service class
@Injectable({ lifetime: 'singleton' })
export class MyService {
  // Injected dependencies
  @Injected(OtherService)
  declare private otherService: OtherService

  // Observable state
  public state = new ObservableValue<ServiceState | null>(null)

  // Public methods
  public getData(): string {
    return this.state.getValue()?.data ?? ''
  }
}
```

## JSX/TSX Code Style

### JSX Formatting

```tsx
// ✅ Good - multi-line for readability
<button
  type="button"
  onclick={handleClick}
  style={{ padding: '8px 16px' }}
>
  Save Changes
</button>

// ✅ Good - single line for simple cases
<button onclick={handleClick}>Save</button>

// ❌ Avoid - hard to read
<button type="button" onclick={handleClick} style={{ padding: '8px 16px' }}>Save Changes</button>
```

### Conditional Rendering

```tsx
// ✅ Good - logical AND for simple cases
{
  isLoading && <div>Loading...</div>
}

// ✅ Good - ternary for if-else
{
  isLoading ? <div>Loading...</div> : <div>Content</div>
}

// ✅ Good - early return for complex cases
if (isLoading) return <div>Loading...</div>
if (error) return <div>Error: {error}</div>
return <div>Content</div>

// ❌ Avoid - nested ternaries
{
  isLoading ? <div>Loading...</div> : error ? <div>Error</div> : <div>Content</div>
}
```

## Summary

**Key Principles:**

1. **Follow project's Prettier and ESLint configs**
2. **Use consistent naming:**
   - PascalCase: Components, classes, types
   - camelCase: Functions, variables
   - kebab-case: File names
   - UPPER_SNAKE_CASE: Constants
3. **Organize imports** by category with blank lines
4. **Co-locate tests** with source files
5. **Structure components** in directories when they have assets

**Tools:**

- Prettier: `yarn format`
- ESLint: `yarn lint`
- Type Check: `yarn build`
- Unit Tests: `yarn test:unit`
- E2E Tests: `yarn test:e2e`
